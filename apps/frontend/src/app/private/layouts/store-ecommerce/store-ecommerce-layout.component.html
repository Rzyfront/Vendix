<div class="ecommerce-layout">
  <!-- Header -->
  <header class="ecommerce-header">
    <div class="header-container">
      <div class="header-left">
        <!-- Logo -->
        <a routerLink="/" class="logo">
          @if (store_logo) {
            <img [src]="store_logo" [alt]="store_name" class="logo-img" />
          } @else {
            <div class="logo-fallback">
              <app-icon
                name="shopping-bag"
                [size]="24"
                class="logo-icon"
              ></app-icon>
              <span class="logo-text">{{ store_name }}</span>
            </div>
          }
        </a>

        <!-- Navigation -->
        <nav class="main-nav" [class.open]="show_mobile_menu">
          <a
            routerLink="/"
            routerLinkActive="active"
            [routerLinkActiveOptions]="{ exact: true }"
            >Inicio</a
          >
          <a routerLink="/products" routerLinkActive="active">Productos</a>
          <a routerLink="/new" routerLinkActive="active">Novedades</a>
          <a routerLink="/sale" routerLinkActive="active">Ofertas</a>
        </nav>
      </div>

      <!-- Search Autocomplete -->
      <app-search-autocomplete class="header-search" />

      <!-- Actions -->
      <div class="header-actions">
        <!-- Icons visible only if authenticated -->
        @if (is_authenticated$ | async) {
          <!-- Wishlist -->
          <button class="action-btn" (click)="goToWishlist()" title="Favoritos">
            <app-icon name="heart" [size]="20"></app-icon>
          </button>

          <!-- User Profile Icon -->
          <button class="action-btn" (click)="goToAccount()" title="Mi Perfil">
            <app-icon name="user-circle" [size]="20"></app-icon>
          </button>
        }

        <!-- Cart -->
        <button
          class="action-btn cart-btn"
          (click)="goToCart()"
          title="Carrito"
        >
          <app-icon name="shopping-cart" [size]="20"></app-icon>
          @if (cart_badge$ | async; as badge) {
            @if (badge.show) {
              <span class="cart-badge">{{ badge.count }}</span>
            }
          }
        </button>

        <!-- User Menu (Guest or Authenticated Dropdown) -->
        <div class="user-menu-container">
          <button class="user-btn" (click)="toggleUserMenu()">
            @if (is_authenticated$ | async) {
              <span class="user-name">{{ user_name$ | async }}</span>
              <app-icon
                name="chevron-down"
                [size]="12"
                class="chevron-icon"
              ></app-icon>
            } @else {
              <app-icon name="user" [size]="20"></app-icon>
            }
          </button>
          @if (show_user_menu) {
            <div class="user-dropdown">
              @if (is_authenticated$ | async) {
                <a (click)="goToAccount()">
                  <app-icon name="user" [size]="16"></app-icon> Ver Perfil
                </a>
                <a (click)="goToWishlist()">
                  <app-icon name="heart" [size]="16"></app-icon> Favoritos
                </a>
                <a (click)="goToOrders()">
                  <app-icon name="list" [size]="16"></app-icon> Ordenes
                </a>
                <hr />
                <a (click)="logout()" class="logout-link">
                  <app-icon name="logout" [size]="16"></app-icon> Cerrar Sesión
                </a>
              } @else {
                <a (click)="login()">
                  <app-icon name="log-in" [size]="16"></app-icon> Iniciar Sesión
                </a>
                <a (click)="register()">
                  <app-icon name="user-plus" [size]="16"></app-icon> Registrarse
                </a>
              }
            </div>
          }
        </div>

        <!-- Mobile Menu Toggle -->
        <button class="mobile-menu-btn" (click)="toggleMobileMenu()">
          <app-icon name="menu" [size]="24"></app-icon>
        </button>
      </div>
    </div>
  </header>

  <!-- Main Content -->
  <main class="ecommerce-main">
    <router-outlet></router-outlet>
  </main>

  <!-- Footer -->
  <footer class="ecommerce-footer">
    <div class="footer-container">
      <div class="footer-section">
        <h4>{{ store_name }}</h4>
        <p>Tu tienda de confianza</p>
      </div>
      <div class="footer-section">
        <h4>Enlaces</h4>
        <a routerLink="/catalog">Productos</a>
        <a routerLink="/about">Nosotros</a>
        <a routerLink="/contact">Contacto</a>
      </div>
      <div class="footer-section">
        <h4>Ayuda</h4>
        <a routerLink="/faq">Preguntas Frecuentes</a>
        <a routerLink="/shipping">Envíos</a>
        <a routerLink="/returns">Devoluciones</a>
      </div>
      <div class="footer-section">
        <h4>Síguenos</h4>
        <div class="social-links">
          <a href="#" target="_blank"><i class="pi pi-facebook"></i></a>
          <a href="#" target="_blank"><i class="pi pi-instagram"></i></a>
          <a href="#" target="_blank"><i class="pi pi-twitter"></i></a>
        </div>
      </div>
    </div>
    <div class="footer-bottom">
      <p>&copy; {{ store_name }} 2025. Todos los derechos reservados.</p>
    </div>
  </footer>
</div>

<!-- Overlay for mobile menu -->
@if (show_mobile_menu) {
  <div class="mobile-overlay" (click)="toggleMobileMenu()"></div>
}

<app-auth-modal
  [isOpen]="is_auth_modal_open"
  [initialMode]="auth_modal_mode"
  [storeLogo]="store_logo"
  [storeName]="store_name"
  (closed)="is_auth_modal_open = false"
></app-auth-modal>
