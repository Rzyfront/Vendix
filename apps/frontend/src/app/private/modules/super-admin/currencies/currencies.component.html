<!-- Standard Module Layout -->
<div class="flex flex-col gap-6">

  <!-- Stats Grid (Gold Standard) -->
  <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-4">
    <app-stats title="Total Monedas" [value]="currencyStats()?.total_currencies || 0" iconName="dollar-sign"
      iconBgColor="bg-blue-100" iconColor="text-blue-600"></app-stats>

    <app-stats title="Monedas Activas" [value]="currencyStats()?.active_currencies || 0" iconName="check-circle"
      iconBgColor="bg-green-100" iconColor="text-green-600"></app-stats>

    <app-stats title="Monedas Inactivas" [value]="currencyStats()?.inactive_currencies || 0" iconName="slash"
      iconBgColor="bg-yellow-100" iconColor="text-yellow-600"></app-stats>

    <app-stats title="Monedas Obsoletas" [value]="currencyStats()?.deprecated_currencies || 0" iconName="archive"
      iconBgColor="bg-red-100" iconColor="text-red-600"></app-stats>
  </div>

  <!-- Main Content Card -->
  <div class="flex flex-col bg-surface border border-border rounded-xl shadow-sm overflow-hidden">

    <!-- Table Header (Compact & Symmetric) -->
    <div
      class="p-2 md:px-6 md:py-4 border-b border-border flex flex-col sm:flex-row gap-4 items-start sm:items-center justify-between bg-surface">

      <!-- LeftSide (Title & Help) -->
      <div class="flex-1 min-w-0">
        <h3 class="text-lg font-semibold text-text-primary">
          Listado de Monedas
        </h3>
        <p class="hidden sm:block text-xs text-text-secondary mt-0.5">
          Gestiona las divisas disponibles en el sistema (ISO 4217)
        </p>
      </div>

      <!-- RightSide (Controls) -->
      <div class="flex flex-col sm:flex-row items-stretch sm:items-center gap-3 w-full sm:w-auto">

        <!-- Search -->
        <div class="w-full sm:w-60">
          <app-inputsearch placeholder="Buscar monedas..." [debounceTime]="300" (searchChange)="onSearchChange($event)"
            size="sm" fullWidth="true"></app-inputsearch>
        </div>

        <!-- Selector (No Label, size="sm") -->
        <div class="w-full sm:w-48">
          <app-selector placeholder="Filtrar por estado" [options]="stateOptions"
            [formControl]="$any(filterForm.get('state'))" size="sm" variant="outline"></app-selector>
        </div>

        <!-- Actions -->
        <div class="flex gap-2 items-center sm:ml-auto">
          <app-button variant="primary" size="sm" iconName="plus" (clicked)="openCreateModal()">
            <span class="hidden sm:inline">Nueva Moneda</span>
            <span class="sm:hidden">Nuevo</span>
          </app-button>
        </div>
      </div>
    </div>

    <!-- Table Container -->
    <div class="relative min-h-[400px] p-2 md:p-4">

      <!-- Loading Overlay -->
      <div *ngIf="isLoading()" class="absolute inset-0 bg-surface/50 z-10 flex items-center justify-center">
        <div class="animate-spin rounded-full h-8 w-8 border-b-2 border-primary"></div>
      </div>

      <!-- Table -->
      <!-- Table -->
      <app-responsive-data-view [columns]="tableColumns" [data]="currencies()" [actions]="tableActions"
        [cardConfig]="cardConfig" [loading]="isLoading()" (sort)="onSortChange($event.column, $event.direction)">
        <!-- Empty State Slot (if table supports it, otherwise after table) -->
        <div class="p-8 flex justify-center w-full" *ngIf="!isLoading() && currencies().length === 0">
          <app-currency-empty-state
            [title]="filterForm.get('search')?.value || filterForm.get('state')?.value ? 'Sin resultados' : 'No hay monedas'"
            [description]="filterForm.get('search')?.value || filterForm.get('state')?.value ? 'Ajusta tus filtros de bÃºsqueda' : 'Comienza creando la primera moneda del sistema'"
            [showAction]="!filterForm.get('search')?.value && !filterForm.get('state')?.value"
            (actionClick)="openCreateModal()"></app-currency-empty-state>
        </div>
      </app-responsive-data-view>
    </div>
  </div>
</div>

<!-- Modals -->
<app-currency-create-modal [isOpen]="showCreateModal()" (isOpenChange)="showCreateModal.set($event)"
  [isSubmitting]="isSubmitting()" (submit)="createCurrency($event)"></app-currency-create-modal>

<app-currency-edit-modal [isOpen]="showEditModal()" (isOpenChange)="showEditModal.set($event)"
  [currency]="selectedCurrency()" [isSubmitting]="isSubmitting()"
  (submit)="updateCurrency($event)"></app-currency-edit-modal>