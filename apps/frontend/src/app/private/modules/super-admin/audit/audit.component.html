<div class="flex flex-col gap-6">
  <!-- Stats Grid -->
  <app-audit-stats [stats]="auditStats()" [showExtendedStats]="true"></app-audit-stats>

  <!-- Main Content Card -->
  <div class="flex flex-col bg-surface border border-border rounded-xl shadow-sm overflow-hidden">

    <!-- Table Header (Title, Description, Controls) -->
    <div
      class="p-2 md:px-6 md:py-4 border-b border-border flex flex-col sm:flex-row gap-4 items-start sm:items-center justify-between bg-surface">

      <!-- Left: Title & Description -->
      <div class="flex-1 min-w-0">
        <h3 class="text-lg font-semibold text-text-primary">
          Listado de Auditoría
        </h3>
        <p class="hidden sm:block text-xs text-text-secondary mt-0.5">
          Historial completo de acciones realizadas en la plataforma
        </p>
      </div>

      <!-- Right: Controls -->
      <div class="flex flex-col sm:flex-row items-stretch sm:items-center gap-3 w-full sm:w-auto">
        <!-- Search -->
        <div class="w-full sm:w-60">
          <app-inputsearch placeholder="Buscar logs..." (searchChange)="onSearchChange($event)"
            size="sm"></app-inputsearch>
        </div>

        <!-- Filter Acción -->
        <div class="w-full sm:w-48">
          <app-selector placeholder="Todas las Acciones" [options]="actionOptions"
            [formControl]="$any(filterForm.get('action'))" size="sm" variant="outline"></app-selector>
        </div>

        <!-- Filter Recurso -->
        <div class="w-full sm:w-48">
          <app-selector placeholder="Todos los Recursos" [options]="resourceOptions"
            [formControl]="$any(filterForm.get('resource'))" size="sm" variant="outline"></app-selector>
        </div>

        <!-- Global Actions -->
        <div class="flex gap-2 items-center sm:ml-auto">
          <app-button variant="outline" size="sm" (clicked)="refreshAuditLogs()" [disabled]="isLoading()"
            title="Actualizar">
            <app-icon name="refresh" [size]="16" slot="icon" [class.animate-spin]="isLoading()"></app-icon>
          </app-button>
          <app-button variant="outline" size="sm" (clicked)="clearFilters()" title="Limpiar">
            <app-icon name="refresh" [size]="16" slot="icon"></app-icon>
          </app-button>
        </div>
      </div>
    </div>

    <!-- Table Content Wrapper -->
    <div class="relative min-h-[400px] p-2 md:p-4">
      <!-- Loading Overlay -->
      <div *ngIf="isLoading()" class="absolute inset-0 bg-surface/50 z-10 flex items-center justify-center">
        <div class="animate-spin rounded-full h-8 w-8 border-b-2 border-primary"></div>
      </div>

      <!-- Empty State -->
      <div class="p-8 flex justify-center w-full" *ngIf="!isLoading() && auditLogs().length === 0">
        <app-audit-empty-state [title]="getEmptyStateTitle()" [description]="getEmptyStateDescription()"
          [showActionButton]="true" (actionClick)="refreshAuditLogs()"></app-audit-empty-state>
      </div>

      <!-- Audit Table -->
      <app-table *ngIf="auditLogs().length > 0" [data]="auditLogs()" [columns]="tableColumns" [actions]="tableActions"
        [loading]="isLoading()" [hoverable]="true" [striped]="true" size="md"
        (rowClick)="viewLogDetails($event)"></app-table>
    </div>

    <!-- Footer / Pagination -->
    <div
      class="px-6 py-4 border-t border-border bg-muted/30 flex flex-col sm:flex-row items-center justify-between gap-4"
      *ngIf="auditLogs().length > 0">
      <div class="text-sm text-text-secondary">
        Mostrando <span class="font-medium text-text-primary">{{ auditLogs().length }}</span> de <span
          class="font-medium text-text-primary">{{ totalItems() }}</span> logs
      </div>

      <div class="flex items-center gap-2">
        <app-button variant="outline" size="sm" [disabled]="currentPage() === 1"
          (clicked)="onPageChange(currentPage() - 1)">
          <app-icon name="chevron-left" [size]="16" slot="icon"></app-icon>
          Anterior
        </app-button>

        <div class="flex items-center gap-1 px-3">
          <span class="text-sm font-medium text-text-primary">{{ currentPage() }}</span>
          <span class="text-xs text-text-secondary">/</span>
          <span class="text-sm text-text-secondary">{{ totalPages() }}</span>
        </div>

        <app-button variant="outline" size="sm" [disabled]="currentPage() === totalPages()"
          (clicked)="onPageChange(currentPage() + 1)">
          Siguiente
          <app-icon name="chevron-right" [size]="16" slot="icon"></app-icon>
        </app-button>
      </div>
    </div>
  </div>
</div>

<!-- Details Modal -->
<app-audit-details-modal [isOpen]="isDetailsModalOpen()" (isOpenChange)="isDetailsModalOpen.set($event)"
  [log]="selectedAuditLog()"></app-audit-details-modal>