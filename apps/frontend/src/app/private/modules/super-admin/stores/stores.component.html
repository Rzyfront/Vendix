<!-- Standard Module Layout -->
<div class="flex flex-col gap-6">

  <!-- Stats Grid -->
  <app-store-stats [stats]="stats"></app-store-stats>

  <!-- Main Content Card -->
  <div class="flex flex-col bg-surface border border-border rounded-xl shadow-sm overflow-hidden">

    <!-- Table Header (Title, Description, Controls) -->
    <div
      class="p-2 md:px-6 md:py-4 border-b border-border flex flex-col sm:flex-row gap-4 items-start sm:items-center justify-between bg-surface">

      <!-- Left: Title & Description -->
      <div class="flex-1 min-w-0">
        <h3 class="text-lg font-semibold text-text-primary">
          Listado de Tiendas
        </h3>
        <p class="hidden sm:block text-xs text-text-secondary mt-0.5">
          Gestiona las tiendas registradas en la plataforma
        </p>
      </div>

      <!-- Right: Controls (Search, Filters, Actions) -->
      <div class="flex flex-col sm:flex-row items-stretch sm:items-center gap-4 w-full sm:w-auto">
        <!-- Search -->
        <div class="w-full sm:w-60">
          <app-inputsearch placeholder="Buscar tiendas..." (searchChange)="onSearchChange($event)"
            size="sm"></app-inputsearch>
        </div>

        <!-- Filter Tipo -->
        <div class="w-full sm:w-48">
          <app-selector [options]="storeTypes" [formControl]="$any(filterForm.get('store_type'))" size="sm"
            variant="outline"></app-selector>
        </div>

        <!-- Filter Estado -->
        <div class="w-full sm:w-48">
          <app-selector [options]="activeStates" [formControl]="$any(filterForm.get('is_active'))" size="sm"
            variant="outline"></app-selector>
        </div>

        <div class="flex gap-2 items-center sm:ml-auto">
          <app-button variant="outline" size="sm" (clicked)="refreshStores()" [disabled]="isLoading"
            title="Actualizar lista">
            <app-icon name="refresh" [size]="16" slot="icon"></app-icon>
          </app-button>
          <app-button variant="primary" size="sm" (clicked)="openCreateStoreModal()" title="Crear Nueva Tienda">
            <app-icon name="plus" [size]="16" slot="icon"></app-icon>
            <span class="hidden sm:inline">Nueva Tienda</span>
            <span class="sm:hidden">Nueva</span>
          </app-button>
        </div>
      </div>
    </div>

    <!-- Table Content Wrapper -->
    <div class="relative min-h-[400px] p-2 md:p-4">
      <!-- Loading Overlay -->
      <div *ngIf="isLoading" class="absolute inset-0 bg-surface/50 z-10 flex items-center justify-center">
        <div class="animate-spin rounded-full h-8 w-8 border-b-2 border-primary"></div>
      </div>

      <!-- Empty State -->
      <div class="p-8 flex justify-center w-full" *ngIf="!isLoading && stores.length === 0">
        <app-store-empty-state [title]="getEmptyStateTitle()" [description]="getEmptyStateDescription()"
          [showAdditionalActions]="hasFilters" (actionClick)="openCreateStoreModal()" (refreshClick)="refreshStores()"
          (clearFiltersClick)="clearFilters()">
        </app-store-empty-state>
      </div>

      <!-- Stores Table -->
      <app-table *ngIf="!isLoading && stores.length > 0" [data]="stores" [columns]="tableColumns"
        [actions]="tableActions" [loading]="isLoading" [sortable]="true" [hoverable]="true" [striped]="true" size="md"
        (sort)="onTableSort($event)" (rowClick)="viewStore($event)">
      </app-table>
    </div>
  </div>

  <!-- Modals -->
  <app-store-create-modal [(isOpen)]="isCreateModalOpen" [isSubmitting]="isCreatingStore"
    (cancel)="onCreateModalCancel()"></app-store-create-modal>

  <app-store-edit-modal [(isOpen)]="isEditModalOpen" [isSubmitting]="isUpdatingStore" [store]="selectedStore"
    (cancel)="onEditModalCancel()"></app-store-edit-modal>

  <app-store-settings-modal [(isOpen)]="isSettingsModalOpen" [isSubmitting]="isUpdatingSettings"
    [settings]="selectedStoreForSettings?.settings" (submit)="updateStoreSettings($event)"></app-store-settings-modal>
</div>