<app-modal [size]="'md'" [title]="isEditMode ? 'Editar Producto' : 'Nuevo Producto'" [isOpen]="isOpen"
  (closed)="onCancel()">

  <div class="p-6">
    <form [formGroup]="productForm" class="space-y-5">

      <!-- Name -->
      <div>
        <app-input label="Nombre" formControlName="name" placeholder="Ej. Camiseta Algodón"
          [error]="getErrorMessage('name')" [required]="true"></app-input>
      </div>

      <!-- Price, Stock & SKU Row -->
      <div class="grid grid-cols-3 gap-4">
        <app-input label="Precio" type="number" formControlName="base_price" [error]="getErrorMessage('base_price')"
          prefix="$" [required]="true" placeholder="0.00"></app-input>

        <app-input label="Stock" type="number" formControlName="stock_quantity"
          [error]="getErrorMessage('stock_quantity')" placeholder="0"></app-input>

        <app-input label="SKU" formControlName="sku" placeholder="Ej. CAM-001"
          [error]="getErrorMessage('sku')"></app-input>
      </div>

      <!-- Category & Brand Row -->
      <div class="grid grid-cols-2 gap-4">
        <div>
          <label class="block text-sm font-medium text-gray-700 mb-1">Categoría</label>
          <div class="flex gap-2">
            <app-selector class="flex-1" [options]="categoryOptions" formControlName="category_id"
              placeholder="Seleccionar"></app-selector>
            <button type="button" (click)="isCategoryCreateOpen = true"
              class="p-2 text-gray-500 hover:bg-gray-50 rounded-lg border border-gray-300 transition-colors"
              title="Nueva categoría">
              <app-icon name="plus" size="18"></app-icon>
            </button>
          </div>
        </div>

        <div>
          <label class="block text-sm font-medium text-gray-700 mb-1">Marca</label>
          <div class="flex gap-2">
            <app-selector class="flex-1" [options]="brandOptions" formControlName="brand_id"
              placeholder="Seleccionar"></app-selector>
            <button type="button" (click)="isBrandCreateOpen = true"
              class="p-2 text-gray-500 hover:bg-gray-50 rounded-lg border border-gray-300 transition-colors"
              title="Nueva marca">
              <app-icon name="plus" size="18"></app-icon>
            </button>
          </div>
        </div>
      </div>

      <!-- Advanced Link -->
      <div class="pt-2">
        <button type="button" (click)="goToAdvancedCreation()"
          class="text-sm text-primary-600 hover:text-primary-700 font-medium flex items-center gap-1 transition-colors">
          <app-icon name="settings" size="14"></app-icon>
          Configuración avanzada (variantes, imágenes, descripción)
        </button>
      </div>

    </form>
  </div>

  <!-- Footer -->
  <div slot="footer" class="max-w-full">
    <div class="flex items-center justify-end gap-3 px-6 py-4 bg-gray-50 rounded-b-xl">
      <app-button variant="outline" (clicked)="onCancel()" [disabled]="isSubmitting">
        Cancelar
      </app-button>

      <app-button variant="primary" (clicked)="onSubmit()" [loading]="isSubmitting" [disabled]="productForm.invalid">
        {{ isEditMode ? 'Guardar' : 'Crear Producto' }}
      </app-button>
    </div>
  </div>
</app-modal>

<!-- Quick Create Modals -->
<app-category-quick-create [isOpen]="isCategoryCreateOpen" (openChange)="isCategoryCreateOpen = $event"
  (created)="onCategoryCreated($event)" (cancel)="isCategoryCreateOpen = false"></app-category-quick-create>

<app-brand-quick-create
  [isOpen]="isBrandCreateOpen"
  (openChange)="isBrandCreateOpen = $event"
  (created)="onBrandCreated($event)"
  (cancel)="isBrandCreateOpen = false"
></app-brand-quick-create>
