<div class="general-settings min-h-screen">
  <app-sticky-header title="Configuración General"
    subtitle="Configura las preferencias administrativas y flujos de negocio" icon="settings" [badgeText]="badgeText()"
    [badgeColor]="badgeColor()" [badgePulse]="badgePulse()" [metadataContent]="metadataContent()"
    [actions]="headerActions()" (actionClicked)="onHeaderAction($event)">
  </app-sticky-header>

  <!-- Section Navigation (mobile: compact horizontal scroll, desktop: hidden) -->
  <div class="sticky top-[41px] z-10 bg-background py-1.5 md:static md:bg-transparent md:py-0 lg:hidden">
    <nav class="flex items-center gap-1 xs:gap-1.5 overflow-x-auto scrollbar-hide" aria-label="Secciones de configuración">
      @for (section of sections; track section.id) {
        <button type="button"
          class="flex items-center gap-1 px-2.5 py-1.5 text-[10px] xs:text-xs font-medium rounded-lg whitespace-nowrap transition-all duration-150 shadow-[0_1px_4px_rgba(0,0,0,0.06)]"
          [class.active-tab]="activeSection() === section.id"
          [class.inactive-tab]="activeSection() !== section.id"
          (click)="scrollToSection(section.id)">
          <app-icon [name]="section.icon" [size]="12"></app-icon>
          <span>{{ section.label }}</span>
        </button>
      }
    </nav>
  </div>

  <!-- Main Content Area -->
  <div class="settings-content">
    @if (isLoading()) {
      <div class="loading-card">
        <div class="loading-spinner"></div>
        <p class="loading-text">Cargando configuraciones...</p>
      </div>
    } @else {
      <div class="settings-grid">
        <!-- Identity & General -->
        <section id="section-identity" class="settings-section">
          <div class="section-header">
            <div class="section-icon section-icon--blue">
              <app-icon name="user" size="18"></app-icon>
            </div>
            <h2 class="section-title">Identidad y General</h2>
          </div>
          <div class="section-body">
            <app-general-settings-form [settings]="settings.general"
              (settingsChange)="onSectionChange('general', $event)"
              (pendingLogoUpload)="onPendingGeneralLogo($event)" />
          </div>
        </section>

        <!-- Branding & Customization -->
        <section id="section-branding" class="settings-section">
          <div class="section-header">
            <div class="section-icon section-icon--pink">
              <app-icon name="palette" size="18"></app-icon>
            </div>
            <h2 class="section-title">Personalización</h2>
          </div>
          <div class="section-body">
            <app-app-settings-form [settings]="settings.app"
              (settingsChange)="onSectionChange('app', $event)"
              (pendingLogoUpload)="onPendingAppLogo($event)"
              (pendingFaviconUpload)="onPendingAppFavicon($event)" />

            <!-- Vendix Domain Info Box -->
            @if (isVendixDomain) {
              <div class="vendix-info-box">
                <div class="vendix-info-content">
                  <div class="vendix-info-icon">
                    <app-icon name="help-circle" size="18"></app-icon>
                  </div>
                  <div class="vendix-info-text">
                    <p class="vendix-info-title">
                      ¿No ves los cambios de personalización en tu tienda?
                    </p>
                    <p class="vendix-info-description">
                      Estás navegando desde el dominio de Vendix. Los cambios de marca, colores y logotipo se aplican en
                      el entorno personalizado de tu tienda. Visita tu app para ver cómo se ve tu marca.
                    </p>
                    @if (storeAppUrl) {
                      <a [href]="storeAppUrl" target="_blank" rel="noopener noreferrer" class="vendix-info-link">
                        <app-icon name="external-link" size="14"></app-icon>
                        Ir a mi app
                      </a>
                    }
                  </div>
                </div>
              </div>
            }
          </div>
        </section>

        <!-- Inventory Section -->
        <section id="section-inventory" class="settings-section">
          <div class="section-header">
            <div class="section-icon section-icon--green">
              <app-icon name="package" size="18"></app-icon>
            </div>
            <h2 class="section-title">Inventario</h2>
          </div>
          <div class="section-body">
            <app-inventory-settings-form [settings]="settings.inventory"
              (settingsChange)="onSectionChange('inventory', $event)" />
          </div>
        </section>

        <!-- Notifications Section -->
        <section id="section-notifications" class="settings-section">
          <div class="section-header">
            <div class="section-icon section-icon--purple">
              <app-icon name="bell" size="18"></app-icon>
            </div>
            <h2 class="section-title">Notificaciones</h2>
          </div>
          <div class="section-body">
            <app-notifications-settings-form [settings]="settings.notifications"
              (settingsChange)="onSectionChange('notifications', $event)" />
          </div>
        </section>

        <!-- POS Section -->
        <section id="section-pos" class="settings-section">
          <div class="section-header">
            <div class="section-icon section-icon--orange">
              <app-icon name="monitor" size="18"></app-icon>
            </div>
            <h2 class="section-title">Punto de Venta (POS)</h2>
          </div>
          <div class="section-body">
            <app-pos-settings-form [settings]="settings.pos" (settingsChange)="onSectionChange('pos', $event)" />
          </div>
        </section>

        <!-- Receipts Section -->
        <section id="section-receipts" class="settings-section">
          <div class="section-header">
            <div class="section-icon section-icon--indigo">
              <app-icon name="file-text" size="18"></app-icon>
            </div>
            <h2 class="section-title">Recibos y Facturación</h2>
          </div>
          <div class="section-body">
            <app-receipts-settings-form [settings]="settings.receipts"
              (settingsChange)="onSectionChange('receipts', $event)" />
          </div>
        </section>
      </div>
    }
  </div>
</div>
