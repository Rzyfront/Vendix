<div class="general-settings min-h-screen">
  <!-- Sticky Header -->
  <div
    class="sticky top-0 z-30 bg-white/80 backdrop-blur-md border-b border-gray-200 p-4 md:px-6 md:py-4 shadow-sm mb-6 rounded-b-xl">
    <div class="max-w-[1600px] mx-auto flex flex-col sm:flex-row sm:items-center justify-between gap-4">
      <!-- Left: Info & Badge -->
      <div class="flex items-center gap-4">
        <div class="w-12 h-12 rounded-xl bg-blue-50 flex items-center justify-center border border-blue-100">
          <app-icon name="settings" size="24" class="text-blue-600"></app-icon>
        </div>
        <div>
          <div class="flex items-center gap-3">
            <h1 class="text-xl font-bold text-gray-900">Configuración General</h1>
            @if (hasUnsavedChanges) {
            <span
              class="px-2 py-1 bg-orange-100 text-orange-700 text-[10px] font-bold uppercase rounded-lg animate-pulse">Pendiente
              de Guardar</span>
            } @else {
            <span
              class="px-2 py-1 bg-green-100 text-green-700 text-[10px] font-bold uppercase rounded-lg">Sincronizado</span>
            }
          </div>
          <p class="text-sm text-gray-500">Configura las preferencias administrativas y flujos de negocio</p>
        </div>
      </div>

      <!-- Right: Actions -->
      <div class="flex items-center gap-3">
        @if (lastSaved) {
        <span class="hidden md:block text-xs text-gray-400 italic mr-2">
          Último guardado: {{ lastSaved | date: 'HH:mm:ss' }}
        </span>
        }

        <app-button variant="outline-danger" size="sm" (clicked)="resetToDefaults()" class="flex-shrink-0">
          <app-icon name="rotate-ccw" size="16" class="mr-2"></app-icon>
          Restablecer
        </app-button>

        <app-button variant="primary" size="sm" [loading]="isSaving" [disabled]="!hasUnsavedChanges && !isSaving"
          (clicked)="saveAllSettings()" class="flex-shrink-0">
          <app-icon name="save" size="16" class="mr-2"></app-icon>
          Guardar Cambios
        </app-button>
      </div>
    </div>
  </div>

  <!-- Main Content Area -->
  <div class="max-w-[1600px] mx-auto p-4 md:p-6 pb-20">
    @if (isLoading) {
    <div class="bg-white rounded-2xl shadow-sm border border-gray-100 p-12">
      <div class="text-center">
        <div class="inline-block animate-spin rounded-full h-10 w-10 border-4 border-blue-100 border-t-blue-600 mb-4">
        </div>
        <p class="text-gray-500 font-medium">Cargando configuraciones...</p>
      </div>
    </div>
    } @else {
    <div class="h-full">
      <div class="columns-1 lg:columns-2 gap-6 space-y-6">
        <!-- Identity & General (Merged Section) -->
        <div class="break-inside-avoid mb-6 bg-white rounded-xl border border-gray-200 p-4 md:p-6 shadow-sm">
          <h2 class="text-lg font-semibold text-gray-900 mb-4 flex items-center gap-2">
            <div class="w-8 h-8 rounded-lg bg-blue-50 flex items-center justify-center">
              <app-icon name="user" size="18" class="text-blue-600"></app-icon>
            </div>
            Identidad y General
          </h2>
          <div class="space-y-8">
            <app-general-settings-form [settings]="settings.general"
              (settingsChange)="onSectionChange('general', $event)" />
            <hr class="border-gray-100">
            <app-app-settings-form [settings]="settings.app" (settingsChange)="onSectionChange('app', $event)" />
          </div>
        </div>

        <!-- Inventory Section -->
        <div class="break-inside-avoid mb-6 bg-white rounded-xl border border-gray-200 p-4 md:p-6 shadow-sm">
          <h2 class="text-lg font-semibold text-gray-900 mb-4 flex items-center gap-2">
            <div class="w-8 h-8 rounded-lg bg-green-50 flex items-center justify-center">
              <app-icon name="package" size="18" class="text-green-600"></app-icon>
            </div>
            Inventario
          </h2>
          <app-inventory-settings-form [settings]="settings.inventory"
            (settingsChange)="onSectionChange('inventory', $event)" />
        </div>

        <!-- Notifications Section -->
        <div class="break-inside-avoid mb-6 bg-white rounded-xl border border-gray-200 p-4 md:p-6 shadow-sm">
          <h2 class="text-lg font-semibold text-gray-900 mb-4 flex items-center gap-2">
            <div class="w-8 h-8 rounded-lg bg-purple-50 flex items-center justify-center">
              <app-icon name="bell" size="18" class="text-purple-600"></app-icon>
            </div>
            Notificaciones
          </h2>
          <app-notifications-settings-form [settings]="settings.notifications"
            (settingsChange)="onSectionChange('notifications', $event)" />
        </div>

        <!-- POS Section -->
        <div class="break-inside-avoid mb-6 bg-white rounded-xl border border-gray-200 p-4 md:p-6 shadow-sm">
          <h2 class="text-lg font-semibold text-gray-900 mb-4 flex items-center gap-2">
            <div class="w-8 h-8 rounded-lg bg-orange-50 flex items-center justify-center">
              <app-icon name="monitor" size="18" class="text-orange-600"></app-icon>
            </div>
            Punto de Venta (POS)
          </h2>
          <app-pos-settings-form [settings]="settings.pos" (settingsChange)="onSectionChange('pos', $event)" />
        </div>

        <!-- Receipts Section -->
        <div class="break-inside-avoid mb-6 bg-white rounded-xl border border-gray-200 p-4 md:p-6 shadow-sm">
          <h2 class="text-lg font-semibold text-gray-900 mb-4 flex items-center gap-2">
            <div class="w-8 h-8 rounded-lg bg-indigo-50 flex items-center justify-center">
              <app-icon name="file-text" size="18" class="text-indigo-600"></app-icon>
            </div>
            Recibos y Facturación
          </h2>
          <app-receipts-settings-form [settings]="settings.receipts"
            (settingsChange)="onSectionChange('receipts', $event)" />
        </div>

      </div>
    </div>
    }
  </div>
</div>