### VENDIX - Complete Onboarding API Tests
### Archivo completo para probar todos los endpoints de onboarding

@baseUrl = http://localhost:3000/api
@access_token = TU_TOKEN_AQUI
@organization_id = TU_ORGANIZATION_ID_AQUI
@store_id = TU_STORE_ID_AQUI

### ============================================
### 0. HEALTH CHECK - Verificar servidor
### ============================================
GET {{baseUrl}}/health

### ============================================
### PASO 1: REGISTRO OWNER (PRE-CREA ORGANIZACIÓN) YA RECIBE ACCESS TOKEN
### ============================================
POST {{baseUrl}}/auth/register-owner
Content-Type: application/json

{
  "organization_name": "Test Organization Onboarding",
  "email": "testonboarding@example.com",
  "password": "TestPass123!",
  "first_name": "Test",
  "last_name": "Onboarding"
}

### ============================================
### PASO 2: VERIFICAR EMAIL
### ============================================
# Simular verificación: UPDATE users SET email_verified = true WHERE email = 'testonboarding@example.com';


### ============================================
### PASO 3: SETUP ORGANIZACIÓN
### ============================================
POST {{baseUrl}}/auth/onboarding/setup-organization/{{organization_id}}
Content-Type: application/json
Authorization: Bearer {{access_token}}

{
  "description": "Empresa dedicada al comercio electrónico y distribución",
  "phone": "+57 300 123 4567",
  "website": "https://miempresa.com",
  "address_line1": "Calle 123 #45-67",
  "address_line2": "Oficina 301",
  "city": "Bogotá",
  "state_province": "Cundinamarca",
  "postal_code": "110111",
  "country_code": "CO"
}

### ============================================
### PASO 4: CREAR Y CONFIGURAR TIENDA COMPLETA
### ============================================
POST {{baseUrl}}/auth/onboarding/create-store/{{organization_id}}
Content-Type: application/json
Authorization: Bearer {{access_token}}

{
  "name": "Tienda Principal",
  "phone": "+57 301 987 6543",
  "email": "tienda@miempresa.com",
  "address_line1": "Carrera 45 #123-45",
  "address_line2": "Local 1",
  "city": "Bogotá",
  "state_province": "Cundinamarca",
  "postal_code": "110111",
  "country_code": "CO",
  "currency_code": "COP",
  "timezone": "America/Bogota",
  "track_inventory": true,
  "allow_backorders": false,
  "low_stock_threshold": 5,
  "enable_shipping": true,
  "free_shipping_threshold": 100000,
  "enable_cod": true,
  "enable_online_payments": true
}

### ============================================
### PASO 5: CONFIGURAR DOMINIO
### ============================================
POST {{baseUrl}}/domains
Content-Type: application/json
Authorization: Bearer {{access_token}}

{
  "hostname": "test-organization-onboarding.localhost",
  "organizationId": {{organization_id}},
  "config": {
    "branding": {
      "primaryColor": "#007bff",
      "secondaryColor": "#6c757d"
    }
  }
}

### ============================================
### PASO 6: COMPLETAR ONBOARDING
### ============================================
POST {{baseUrl}}/auth/onboarding/complete
Content-Type: application/json
Authorization: Bearer {{access_token}}

{}

### ============================================
### VERIFICAR ESTADO FINAL
### ============================================
GET {{baseUrl}}/auth/onboarding/status
Content-Type: application/json
Authorization: Bearer {{access_token}}

### ============================================
### ERROR CASES TESTING
### ============================================

### ============================================
### 11. INTENTO REPETIR COMPLETADO - 400
### ============================================
POST {{baseUrl}}/auth/onboarding/complete
Content-Type: application/json
Authorization: Bearer {{access_token}}

{}

### ============================================
### 12. INTENTO CREAR ORGANIZACIÓN YA EXISTENTE - 400
### ============================================
POST {{baseUrl}}/auth/onboarding/create-organization
Content-Type: application/json
Authorization: Bearer {{access_token}}

{
  "name": "Otra Empresa",
  "description": "Otra empresa de prueba"
}

### ============================================
### 13. INTENTO SETUP ORGANIZACIÓN INEXISTENTE - 400
### ============================================
POST {{baseUrl}}/auth/onboarding/setup-organization/99999
Content-Type: application/json
Authorization: Bearer {{access_token}}

{
  "description": "Descripción de prueba"
}

### ============================================
### 14. INTENTO CREAR TIENDA EN ORGANIZACIÓN INEXISTENTE - 400
### ============================================
POST {{baseUrl}}/auth/onboarding/create-store/99999
Content-Type: application/json
Authorization: Bearer {{access_token}}

{
  "name": "Tienda de Prueba"
}

### ============================================
### 15. INTENTO SETUP TIENDA INEXISTENTE - 400
### ============================================
POST {{baseUrl}}/auth/onboarding/setup-store/99999
Content-Type: application/json
Authorization: Bearer {{access_token}}

{
  "description": "Descripción de prueba"
}

### ============================================
### VERIFICACIÓN EN BASE DE DATOS
### ============================================

### ============================================
### 16. VERIFICAR DATOS EN BD
### ============================================
# SELECT
#   u.id, u.email, u.first_name, u.last_name, u.email_verified, u.onboarding_completed,
#   o.name as org_name, o.description as org_description,
#   s.name as store_name, s.description as store_description
# FROM users u
# LEFT JOIN organizations o ON u.organization_id = o.id
# LEFT JOIN stores s ON s.organization_id = o.id
# WHERE u.email = 'testonboarding@example.com';
